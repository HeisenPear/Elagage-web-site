---
/**
 * Page index du blog
 * Liste tous les articles avec filtres par catÃ©gorie
 */
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { siteConfig } from '@/data/siteConfig';

// RÃ©cupÃ©rer tous les articles, triÃ©s par date
const allPosts = (await getCollection('blog')).sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);

// Articles mis en avant
const featuredPosts = allPosts.filter(post => post.data.featured);

// CatÃ©gories
const categories = [
  { id: 'tous', label: 'Tous les articles', count: allPosts.length },
  { id: 'elagage', label: 'Ã‰lagage', count: allPosts.filter(p => p.data.category === 'elagage').length },
  { id: 'abattage', label: 'Abattage', count: allPosts.filter(p => p.data.category === 'abattage').length },
  { id: 'conseils', label: 'Conseils', count: allPosts.filter(p => p.data.category === 'conseils').length },
  { id: 'reglementation', label: 'RÃ©glementation', count: allPosts.filter(p => p.data.category === 'reglementation').length },
  { id: 'saisonnier', label: 'Saisonnier', count: allPosts.filter(p => p.data.category === 'saisonnier').length },
];

// Schema.org pour la page blog
const blogSchema = {
  '@context': 'https://schema.org',
  '@type': 'Blog',
  name: 'Blog Ã‰lagage Abattage 37',
  description: 'Conseils, guides et actualitÃ©s sur l\'Ã©lagage et l\'abattage d\'arbres Ã  Tours et en Indre-et-Loire',
  url: `${Astro.site}blog`,
  publisher: {
    '@type': 'LocalBusiness',
    name: siteConfig.business.name,
  },
};
---

<BaseLayout
  title="Blog Ã‰lagage & Abattage d'Arbres Ã  Tours (37) | Conseils d'Expert"
  description="DÃ©couvrez nos conseils d'experts en Ã©lagage et abattage d'arbres Ã  Tours. Guides pratiques, rÃ©glementation, pÃ©riodes idÃ©ales et astuces pour l'entretien de vos arbres en Indre-et-Loire."
  keywords={[
    'blog Ã©lagage Tours',
    'conseils Ã©lagage',
    'guide abattage arbres',
    'entretien arbres Tours',
    'rÃ©glementation Ã©lagage 37',
    'meilleure pÃ©riode Ã©lagage',
    'prix Ã©lagage Tours',
    'Ã©lagueur professionnel conseils',
  ]}
  schema={blogSchema}
>
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-green-800 to-green-900 text-white py-16 md:py-24">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6">
        Blog Ã‰lagage & Abattage
      </h1>
      <p class="text-xl md:text-2xl text-green-100 max-w-3xl mx-auto leading-relaxed">
        Conseils d'experts, guides pratiques et actualitÃ©s pour l'entretien de vos arbres Ã  Tours et en Indre-et-Loire
      </p>
    </div>
  </section>

  <!-- Articles mis en avant -->
  {featuredPosts.length > 0 && (
    <section class="py-16 bg-green-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-green-900 mb-8">Articles Ã  la une</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {featuredPosts.slice(0, 3).map((post) => (
            <article class="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition group">
              {post.data.image && (
                <a href={`/blog/${post.slug}`}>
                  <img
                    src={post.data.image.src}
                    alt={post.data.image.alt}
                    class="w-full h-48 object-cover group-hover:scale-105 transition duration-300"
                    loading="lazy"
                    width={600}
                    height={400}
                  />
                </a>
              )}
              <div class="p-6">
                <div class="flex items-center gap-3 mb-3">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    {post.data.category}
                  </span>
                  <time datetime={post.data.publishDate.toISOString()} class="text-sm text-gray-500">
                    {new Intl.DateTimeFormat('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' }).format(post.data.publishDate)}
                  </time>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-green-700 transition">
                  <a href={`/blog/${post.slug}`}>{post.data.title}</a>
                </h3>
                <p class="text-gray-600 mb-4 line-clamp-3">{post.data.description}</p>
                <a
                  href={`/blog/${post.slug}`}
                  class="inline-flex items-center text-green-700 font-semibold hover:text-green-800 transition"
                >
                  Lire la suite
                  <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </a>
              </div>
            </article>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Filtres par catÃ©gorie -->
  <section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-wrap gap-3 mb-12">
        {categories.filter(cat => cat.count > 0).map((cat) => (
          <button
            data-category={cat.id}
            class="category-filter px-5 py-2 rounded-full border-2 border-green-700 text-green-700 font-semibold hover:bg-green-700 hover:text-white transition"
          >
            {cat.label} ({cat.count})
          </button>
        ))}
      </div>

      <!-- Liste de tous les articles -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="blog-posts">
        {allPosts.map((post) => (
          <article
            class="blog-post bg-white rounded-2xl shadow-md overflow-hidden hover:shadow-xl transition group"
            data-category={post.data.category}
          >
            {post.data.image && (
              <a href={`/blog/${post.slug}`}>
                <img
                  src={post.data.image.src}
                  alt={post.data.image.alt}
                  class="w-full h-48 object-cover group-hover:scale-105 transition duration-300"
                  loading="lazy"
                  width={600}
                  height={400}
                />
              </a>
            )}
            <div class="p-6">
              <div class="flex items-center gap-3 mb-3">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  {post.data.category}
                </span>
                <time datetime={post.data.publishDate.toISOString()} class="text-sm text-gray-500">
                  {new Intl.DateTimeFormat('fr-FR', { day: 'numeric', month: 'short', year: 'numeric' }).format(post.data.publishDate)}
                </time>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-green-700 transition">
                <a href={`/blog/${post.slug}`}>{post.data.title}</a>
              </h3>
              <p class="text-gray-600 mb-4 line-clamp-3">{post.data.description}</p>
              <a
                href={`/blog/${post.slug}`}
                class="inline-flex items-center text-green-700 font-semibold hover:text-green-800 transition"
              >
                Lire l'article
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </a>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-16 bg-gradient-to-br from-green-700 to-green-900 text-white">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-6">
        Une question sur l'entretien de vos arbres&nbsp;?
      </h2>
      <p class="text-xl text-green-100 mb-8">
        Notre Ã©quipe d'Ã©lagueurs professionnels vous conseille gratuitement
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href="tel:+33631464350"
          class="inline-flex items-center justify-center px-8 py-4 bg-white text-green-700 font-bold rounded-full hover:bg-green-50 transition shadow-lg hover:shadow-xl"
        >
          ðŸ“ž 06 31 46 43 50
        </a>
        <a
          href="/contact"
          class="inline-flex items-center justify-center px-8 py-4 bg-green-800 text-white font-bold rounded-full hover:bg-green-900 transition border-2 border-white"
        >
          Demander un devis gratuit
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Filtrage des articles par catÃ©gorie
  document.addEventListener('DOMContentLoaded', () => {
    const filters = document.querySelectorAll('.category-filter');
    const posts = document.querySelectorAll('.blog-post');

    filters.forEach(filter => {
      filter.addEventListener('click', () => {
        const category = filter.getAttribute('data-category');

        // Mettre Ã  jour l'UI des filtres
        filters.forEach(f => f.classList.remove('bg-green-700', 'text-white'));
        filter.classList.add('bg-green-700', 'text-white');

        // Filtrer les posts
        posts.forEach(post => {
          const postCategory = post.getAttribute('data-category');
          if (category === 'tous' || postCategory === category) {
            (post as HTMLElement).style.display = 'block';
            post.classList.add('animate-on-scroll');
          } else {
            (post as HTMLElement).style.display = 'none';
          }
        });
      });
    });

    // Activer le premier filtre par dÃ©faut
    if (filters.length > 0) {
      filters[0].classList.add('bg-green-700', 'text-white');
    }
  });
</script>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
