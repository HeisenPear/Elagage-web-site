---
/**
 * Page dynamique pour chaque zone d'intervention - Mobile-first SEO
 * G√©n√®re automatiquement une page SEO pour chaque ville
 */
import BaseLayout from '@/layouts/BaseLayout.astro';
import ContactForm from '@/components/react/ContactForm';
import FlipCard from '@/components/react/FlipCard';
import { siteConfig } from '@/data/siteConfig';
import { getLocalBusinessSchema, getBreadcrumbSchema, combineSchemas } from '@/utils/schemas';

// Ic√¥nes SVG pour les FlipCards
const icons = {
  stump: `<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>`,
  tree: `<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>`,
  axe: `<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/></svg>`,
  hedge: `<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
  garden: `<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>`,
  brush: `<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg>`,
};

// Donn√©es des 6 services (m√™me structure que homepage)
const servicesData = [
  {
    icon: icons.stump,
    title: "Dessouchage",
    price: "Sur devis",
    description: "√âlimination compl√®te des souches d'arbres avec rogneuse professionnelle. Intervention rapide dans toute la France.",
    features: [
      "Dessouchage m√©canique avec rogneuse",
      "√âvacuation compl√®te des d√©chets",
      "Remise en √©tat du terrain",
      "Intervention rapide 48h",
      "Devis gratuit sous 24h"
    ],
    gradientFrom: "from-[#679436]",
    gradientTo: "to-[#A4BD01]",
  },
  {
    icon: icons.tree,
    title: "√âlagage d'arbres",
    price: "Sur devis",
    description: "Taille et entretien d'arbres pour leur sant√© et s√©curit√©. √âlagueur grimpeur certifi√© avec 10 ans d'exp√©rience.",
    features: [
      "√âlagage raisonn√© et sanitaire",
      "Respect de la biologie de l'arbre",
      "√âquipement professionnel",
      "√âlagueur certifi√© et assur√©",
      "R√©duction fiscale jusqu'√† 2500‚Ç¨"
    ],
    gradientFrom: "from-emerald-600",
    gradientTo: "to-emerald-400",
  },
  {
    icon: icons.axe,
    title: "Abattage d'arbres",
    price: "Sur devis",
    description: "Abattage s√©curis√© d'arbres dangereux ou g√™nants. Techniques de d√©montage adapt√©es √† votre terrain.",
    features: [
      "Techniques de d√©montage professionnel",
      "√âvacuation totale des v√©g√©taux",
      "Assurance RC Pro 8M‚Ç¨",
      "Devis gratuit sous 24h",
      "Intervention s√©curis√©e"
    ],
    gradientFrom: "from-amber-600",
    gradientTo: "to-amber-400",
  },
  {
    icon: icons.hedge,
    title: "Taille de haies",
    price: "Sur devis",
    description: "Taille et entretien de haies pour un jardin soign√©. Toutes hauteurs, toutes essences.",
    features: [
      "Taille pr√©cise et esth√©tique",
      "Toutes hauteurs accessibles",
      "Ramassage des d√©chets",
      "Sur devis personnalis√©",
      "Intervention rapide"
    ],
    gradientFrom: "from-lime-600",
    gradientTo: "to-lime-400",
  },
  {
    icon: icons.garden,
    title: "Entretien de jardin",
    price: "Sur devis",
    description: "Entretien complet de vos espaces verts. Tonte, taille, d√©broussaillage et contrats annuels.",
    features: [
      "Tonte et scarification",
      "Taille arbustes et massifs",
      "D√©broussaillage complet",
      "Contrats d'entretien annuel",
      "Paiement en plusieurs fois"
    ],
    gradientFrom: "from-teal-600",
    gradientTo: "to-teal-400",
  },
  {
    icon: icons.brush,
    title: "D√©broussaillage",
    price: "Sur devis",
    description: "Nettoyage et d√©broussaillage de terrains. Pr√©vention des incendies et acc√®s difficiles.",
    features: [
      "Tous types de terrains",
      "√âvacuation des v√©g√©taux",
      "Pr√©vention incendie",
      "Acc√®s difficiles OK",
      "Mat√©riel professionnel"
    ],
    gradientFrom: "from-orange-600",
    gradientTo: "to-orange-400",
  },
];

export async function getStaticPaths() {
  return siteConfig.serviceArea.cities.map((city) => ({
    params: {
      // Normalise les accents avant de g√©n√©rer le slug (√© ‚Üí e, √® ‚Üí e, etc.)
      city: city
        .toLowerCase()
        .normalize('NFD') // D√©compose les caract√®res accentu√©s
        .replace(/[\u0300-\u036f]/g, '') // Retire les accents
        .replace(/[^a-z0-9]+/g, '-') // Remplace caract√®res sp√©ciaux par tirets
        .replace(/^-+|-+$/g, ''), // Retire tirets d√©but/fin
    },
    props: {
      cityName: city,
    },
  }));
}

const { city } = Astro.params;
const { cityName } = Astro.props;

// SEO ultra-optimis√© pour la ville - Focus "√©lagage"
const pageTitle = `√âlagage ${cityName} (37) | √âlagueur Professionnel | Devis Gratuit 24h`;
const pageDescription = `üå≥ √âlagage professionnel √† ${cityName} (37) | ${siteConfig.business.name} | √âlagage d'arbres, abattage, taille haies | ‚úÖ Cr√©dit imp√¥t -50% | ‚úÖ RC Pro 8M‚Ç¨ | Devis gratuit ${siteConfig.business.phoneDisplay}`;
const keywords = [
  `√©lagage ${cityName}`,
  `√©lagage arbre ${cityName}`,
  `entreprise √©lagage ${cityName}`,
  `√©lagueur ${cityName}`,
  `√©lagueur professionnel ${cityName}`,
  `√©lagage professionnel ${cityName}`,
  `abattage arbre ${cityName}`,
  `taille haie ${cityName}`,
  `prix √©lagage ${cityName}`,
  `devis √©lagage ${cityName}`,
  `√©lagage arbre fruitier ${cityName}`,
  `√©lagage raisonn√© ${cityName}`,
  'r√©duction fiscale √©lagage',
  'cr√©dit imp√¥t √©lagage',
];

// Configuration SEO
// Toutes les pages de villes sont indexables avec leur propre URL canonique
const canonicalUrl = Astro.url.href;

// Schema.org LocalBusiness avec areaServed pour la ville
const localBusinessSchema = {
  ...getLocalBusinessSchema(),
  areaServed: {
    '@type': 'City',
    name: cityName,
    containedInPlace: {
      '@type': 'AdministrativeArea',
      name: siteConfig.serviceArea.department,
    },
  },
};

// Schema.org BreadcrumbList pour am√©liorer le SEO
const breadcrumbSchema = getBreadcrumbSchema([
  { name: 'Accueil', url: Astro.site?.href || '' },
  { name: 'Zones d\'intervention', url: new URL('/zones', Astro.site).href },
  { name: `√âlagueur ${cityName}`, url: Astro.url.href },
]);

// Combiner les schemas
const schemas = combineSchemas(localBusinessSchema, breadcrumbSchema);
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  keywords={keywords}
  schema={schemas}
  canonical={canonicalUrl}
>
  <!-- Hero Section ville - Mobile optimis√© -->
  <section class="relative pt-32 md:pt-40 pb-12 md:pb-20 bg-gradient-to-br from-primary to-primary-900 text-white">
    <div class="container-custom">
      <!-- Breadcrumb mobile-friendly -->
      <nav class="mb-6 md:mb-8 text-xs md:text-sm" aria-label="Fil d'Ariane">
        <ol class="flex items-center gap-2 text-white/70 flex-wrap">
          <li><a href="/" class="hover:text-white transition-colors">Accueil</a></li>
          <li>/</li>
          <li><a href="/zones" class="hover:text-white transition-colors">Zones</a></li>
          <li>/</li>
          <li class="text-white font-semibold">{cityName}</li>
        </ol>
      </nav>

      <div class="max-w-4xl">
        <span class="inline-block px-3 md:px-4 py-1.5 md:py-2 bg-accent/20 text-accent font-semibold rounded-full text-xs md:text-sm uppercase tracking-wider mb-4">
          üìç {cityName} ‚Ä¢ {siteConfig.serviceArea.department}
        </span>
        <h1 class="text-3xl md:text-5xl font-display font-bold mb-4 md:mb-6">
          √âlagage professionnel √† {cityName}
        </h1>
        <p class="text-base md:text-xl text-white/90 mb-6 md:mb-8">
          {siteConfig.business.name} - Sp√©cialiste de l'√©lagage √† {cityName} et ses environs. √âlagage d'arbres, abattage, taille de haies et entretien d'espaces verts.
          <strong>Devis gratuit sous 24h</strong> ‚Ä¢ <strong>Intervention rapide</strong> ‚Ä¢ <strong>Cr√©dit imp√¥t -50%</strong>
        </p>

        <!-- CTA mobile-optimized (full-width sur mobile) -->
        <div class="flex flex-col sm:flex-row gap-3 md:gap-4">
          <a
            href={`tel:${siteConfig.business.phone}`}
            class="w-full sm:w-auto btn-primary inline-flex items-center justify-center gap-3 text-base md:text-lg"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
            <span>Appeler : {siteConfig.business.phoneDisplay}</span>
          </a>

          <a
            href="#contact"
            class="w-full sm:w-auto inline-flex items-center justify-center gap-3 px-6 md:px-8 py-3 md:py-4 border-2 border-white text-white font-semibold rounded-lg hover:bg-white hover:text-primary transition-all text-base md:text-lg"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
            <span>Devis gratuit</span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Section SEO riche : √âlagueur √† [Ville] -->
  <section class="py-12 md:py-20 bg-white">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto animate-on-scroll">
        <div class="prose prose-lg max-w-none space-y-4 md:space-y-6 text-neutral-gray leading-relaxed">
          <h2 class="text-2xl md:text-3xl font-display font-bold text-primary mb-4 md:mb-6">
            √âlagage professionnel √† {cityName} : votre expert local
          </h2>

          <p class="text-base md:text-lg">
            Vous habitez <strong>{cityName}</strong> et recherchez une <strong>entreprise d'√©lagage professionnelle de proximit√©</strong> ?
            <strong class="text-primary">{siteConfig.business.name}</strong> est le sp√©cialiste de l'√©lagage de r√©f√©rence dans votre commune.
            Bas√©s √† <strong>{siteConfig.business.address.city}</strong>, nous intervenons r√©guli√®rement √† <strong>{cityName}</strong>
            pour tous vos travaux d'<strong>√©lagage d'arbres</strong>, <strong>√©lagage fruitiers</strong>, <strong>abattage d'arbres</strong>,
            <strong>taille de haies</strong> et <strong>entretien d'espaces verts</strong>.
          </p>

          <div class="grid sm:grid-cols-2 gap-4 md:gap-6 my-6 md:my-8">
            <div class="bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl p-4 md:p-6 border border-accent/20">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 md:w-12 md:h-12 bg-accent rounded-lg flex items-center justify-center flex-shrink-0">
                  <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <h3 class="text-base md:text-lg font-bold text-primary">Intervention rapide</h3>
              </div>
              <p class="text-sm md:text-base">
                D√©lai d'intervention <strong>sous 48h</strong> √† {cityName}. D√©placement gratuit pour √©tablir votre devis.
              </p>
            </div>

            <div class="bg-gradient-to-br from-secondary/10 to-secondary/5 rounded-xl p-4 md:p-6 border border-secondary/20">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 md:w-12 md:h-12 bg-secondary rounded-lg flex items-center justify-center flex-shrink-0">
                  <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <h3 class="text-base md:text-lg font-bold text-primary">Cr√©dit d'imp√¥t -50%</h3>
              </div>
              <p class="text-sm md:text-base">
                Profitez de <strong>2 500‚Ç¨ de r√©duction fiscale</strong> sur vos travaux d'√©lagage √† {cityName}.
              </p>
            </div>
          </div>

          <p class="text-base md:text-lg">
            Avec <strong>{siteConfig.stats.yearsExperience} ans d'exp√©rience</strong> dans l'<strong>√©lagage professionnel</strong> en
            <strong>{siteConfig.serviceArea.department}</strong>, nous sommes l'une des entreprises d'√©lagage les plus reconnues de la r√©gion.
            Nos <strong>√©lagueurs grimpeurs certifi√©s</strong> ma√Ætrisent toutes les techniques d'<strong>√©lagage raisonn√©</strong> et d'<strong>√©lagage sanitaire</strong>.
            Nous intervenons avec du mat√©riel professionnel r√©cent et sommes couverts par une <strong>assurance RC Professionnelle de 8 millions d'euros</strong>.
          </p>

          <p class="text-base md:text-lg">
            Que vous soyez <strong>particulier</strong> ou <strong>professionnel</strong> (syndic, mairie, entreprise) √† {cityName},
            nous adaptons nos prestations d'√©lagage √† vos besoins : <strong>√©lagage d'arbres d'ombrage</strong>, <strong>√©lagage d'arbres fruitiers</strong>,
            <strong>√©lagage de s√©curit√©</strong>, abattage s√©curis√©, dessouchage, taille de haies, d√©broussaillage et entretien complet de vos espaces verts.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Section Services √† [Ville] avec FlipCards (identique homepage) -->
  <section class="py-12 md:py-20 bg-neutral-cream relative overflow-hidden">
    <!-- Background decorative element -->
    <div class="absolute top-20 right-0 w-96 h-96 bg-accent/5 rounded-full blur-3xl -z-0" aria-hidden="true"></div>

    <div class="container-custom relative z-10">
      <div class="text-center max-w-3xl mx-auto mb-12 md:mb-16 animate-on-scroll">
        <span class="inline-block px-4 py-2 bg-accent/10 text-accent font-semibold rounded-full text-xs md:text-sm uppercase tracking-wider mb-4">
          Nos services
        </span>
        <h2 class="text-2xl md:text-4xl font-display font-bold text-primary mb-4 md:mb-6">
          Nos prestations √† {cityName}
        </h2>
        <p class="text-base md:text-lg text-neutral-gray">
          De l'√©lagage d'arbres en hauteur √† l'entretien de haies, nous intervenons pour tous vos besoins d'entretien paysager √† {cityName}.
        </p>
      </div>

      <!-- FlipCards grid (identique √† la homepage) -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
        {servicesData.map((service) => (
          <FlipCard
            client:idle
            icon={service.icon}
            title={service.title}
            price={service.price}
            description={service.description}
            features={service.features}
            gradientFrom={service.gradientFrom}
            gradientTo={service.gradientTo}
            ctaText="Demander un devis"
            ctaHref="/contact"
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Section Avantages - Supprim√©e (d√©j√† dans section SEO riche) -->

  <!-- Section Contact - Mobile optimis√©e -->
  <section id="contact" class="py-12 md:py-20 bg-white">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-8 md:mb-12 animate-on-scroll">
          <span class="inline-block px-3 md:px-4 py-1.5 md:py-2 bg-accent/10 text-accent font-semibold rounded-full text-xs md:text-sm uppercase tracking-wider mb-4">
            Demande de devis
          </span>
          <h2 class="text-2xl md:text-4xl font-display font-bold text-primary mb-3 md:mb-4">
            Demandez votre devis gratuit √† {cityName}
          </h2>
          <p class="text-sm md:text-xl text-neutral-gray">
            R√©ponse sous 24h ‚Ä¢ D√©placement gratuit ‚Ä¢ Devis sans engagement
          </p>
        </div>

        <div class="bg-gradient-to-br from-white to-neutral-cream rounded-2xl shadow-lift p-6 md:p-12 border border-accent/10">
          <ContactForm client:visible />
        </div>
      </div>
    </div>
  </section>

  <!-- Section Zones proches - Mobile optimis√©e -->
  <section class="py-12 md:py-20 bg-gradient-to-br from-neutral-cream to-white">
    <div class="container-custom">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-xl md:text-3xl font-display font-bold text-primary mb-6 md:mb-8 text-center">
          Nous intervenons √©galement pr√®s de {cityName}
        </h2>

        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4">
          {siteConfig.serviceArea.cities
            .filter(c => c !== cityName)
            .slice(0, 16)
            .map((nearbyCity) => (
              <a
                href={`/zones/${nearbyCity.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`}
                class="px-4 py-3 bg-white rounded-lg text-center text-sm md:text-base text-primary hover:bg-accent hover:text-white transition-all duration-300 shadow-soft hover:shadow-lift hover:scale-105"
              >
                {nearbyCity}
              </a>
            ))
          }
        </div>

        <div class="text-center mt-8 md:mt-12">
          <a href="/zones" class="inline-flex items-center gap-2 text-accent hover:text-primary font-semibold text-sm md:text-base">
            <span>Voir toutes les zones d'intervention</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA t√©l√©phone sticky mobile (visible uniquement sur mobile) -->
  <div class="fixed bottom-0 left-0 right-0 z-50 lg:hidden bg-gradient-to-r from-accent to-accent/90 shadow-2xl border-t-4 border-white/20 backdrop-blur-sm">
    <a
      href={`tel:${siteConfig.business.phone}`}
      class="flex items-center justify-center gap-3 px-6 py-4 text-white font-bold text-base md:text-lg"
    >
      <svg class="w-6 h-6 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
      </svg>
      <span>Appeler : {siteConfig.business.phoneDisplay}</span>
    </a>
  </div>
</BaseLayout>
